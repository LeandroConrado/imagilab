<form action="{{ action_url }}" method="POST" enctype="multipart/form-data">
    <div class="row">
        {# Coluna Esquerda: Dados Principais #}
        <div class="col-md-8">
            <div class="card mb-3">
                <div class="card-body">
                    <h5>Informações Básicas</h5>
                    <div class="mb-3">
                        <label for="nome" class="form-label">Nome do Produto</label>
                        <input type="text" class="form-control" id="nome" name="nome" value="{{ produto.nome ?? '' }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="descricao" class="form-label">Descrição</label>
                        <textarea class="form-control" id="descricao" name="descricao" rows="6">{{ produto.descricao ?? '' }}</textarea>
                    </div>
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-body">
                     <h5>Imagens</h5>
                     <div class="mb-3">
                        <label for="imagens" class="form-label">Enviar novas imagens</label>
                        <input type="file" class="form-control" id="imagens" name="imagens[]" multiple>
                         {% if produto.imagens is defined and produto.imagens is not empty %}
                            <div class="mt-3">
                                <p>Imagens Atuais:</p>
                                {% for imagem in produto.imagens %}
                                    <img src="{{ imagem.caminho_imagem }}" alt="Imagem do produto" height="80" class="me-2 mb-2 border rounded">
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-body">
                     <h5>Preços</h5>
                     <div class="row">
                         <div class="col-md-4 mb-3">
                            <label for="preco" class="form-label">Preço de Venda (R$)</label>
                            <input type="text" class="form-control" id="preco" name="preco" placeholder="19,90" value="{{ produto.preco ?? '' }}">
                        </div>
                         <div class="col-md-4 mb-3">
                            <label for="preco_promocional" class="form-label">Preço Promocional (R$)</label>
                            <input type="text" class="form-control" id="preco_promocional" name="preco_promocional" placeholder="14,90" value="{{ produto.preco_promocional ?? '' }}">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="preco_custo" class="form-label">Preço de Custo (R$)</label>
                            <input type="text" class="form-control" id="preco_custo" name="preco_custo" placeholder="10,00" value="{{ produto.preco_custo ?? '' }}">
                        </div>
                     </div>
                </div>
            </div>

             <div class="card mb-3">
                <div class="card-body">
                     <h5>Logística e Frete</h5>
                     <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="estoque" class="form-label">Estoque Atual</label>
                            <input type="number" class="form-control" id="estoque" name="estoque" value="{{ produto.estoque ?? '0' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="estoque_minimo" class="form-label">Estoque Mínimo</label>
                            <input type="number" class="form-control" id="estoque_minimo" name="estoque_minimo" value="{{ produto.estoque_minimo ?? '0' }}">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="peso_kg" class="form-label">Peso (kg)</label>
                            <input type="text" class="form-control" id="peso_kg" name="peso_kg" placeholder="0,500" value="{{ produto.peso_kg ?? '' }}">
                        </div>
                         <div class="col-md-3 mb-3">
                            <label for="altura_cm" class="form-label">Altura (cm)</label>
                            <input type="number" class="form-control" id="altura_cm" name="altura_cm" value="{{ produto.altura_cm ?? '' }}">
                        </div>
                         <div class="col-md-3 mb-3">
                            <label for="largura_cm" class="form-label">Largura (cm)</label>
                            <input type="number" class="form-control" id="largura_cm" name="largura_cm" value="{{ produto.largura_cm ?? '' }}">
                        </div>
                         <div class="col-md-3 mb-3">
                            <label for="profundidade_cm" class="form-label">Profundidade (cm)</label>
                            <input type="number" class="form-control" id="profundidade_cm" name="profundidade_cm" value="{{ produto.profundidade_cm ?? '' }}">
                        </div>
                     </div>
                </div>
            </div>
        </div>

        {# Coluna Direita: Organização #}
        <div class="col-md-4">
             <div class="card">
                <div class="card-body">
                    <h5>Publicação</h5>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" role="switch" id="anunciar" name="anunciar" {{ (produto.anunciar ?? 1) ? 'checked' : '' }}>
                        <label class="form-check-label" for="anunciar">Anunciar Produto</label>
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" role="switch" id="destaque" name="destaque" {{ (produto.destaque ?? 0) ? 'checked' : '' }}>
                        <label class="form-check-label" for="destaque">Produto em Destaque</label>
                    </div>

                    <h5 class="mt-4">Organização</h5>
                     <div class="mb-3">
                        <label for="categoria_id" class="form-label">Categoria</label>
                        <select class="form-select" id="categoria_id" name="categoria_id">
                            <option value="">Nenhuma</option>
                            {% for categoria in categorias %}
                                <option value="{{ categoria.id }}" {{ (produto.categoria_id ?? '') == categoria.id ? 'selected' : '' }}>{{ categoria.nome }}</option>
                            {% endfor %}
                        </select>
                     </div>
                     <div class="mb-3">
                        <label for="fornecedor_id" class="form-label">Fornecedor</label>
                        <select class="form-select" id="fornecedor_id" name="fornecedor_id">
                             <option value="">Nenhum</option>
                            {% for fornecedor in fornecedores %}
                                <option value="{{ fornecedor.id }}" {{ (produto.fornecedor_id ?? '') == fornecedor.id ? 'selected' : '' }}>{{ fornecedor.nome }}</option>
                            {% endfor %}
                        </select>
                     </div>
                </div>
             </div>
        </div>
    </div>
    <div class="mt-3">
        <a href="/admin/produtos" class="btn btn-secondary">Cancelar</a>
        <button type="submit" class="btn btn-primary">{{ button_label ?? 'Salvar' }}</button>
    </div>
</form>